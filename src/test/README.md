# Тесты для проекта TaskTracker

## Обзор

Этот каталог содержит полный набор unit-тестов и интеграционных тестов для проекта TaskTracker. Тесты покрывают все основные компоненты системы и обеспечивают высокое качество кода.

## Структура тестов

### 1. Unit-тесты

#### Service Layer Tests
- **TaskServiceTest** - Тесты для сервиса управления задачами
  - Тестирование изменения статуса задач
  - Тестирование добавления комментариев
  - Тестирование обновления задач
  - Тестирование обработки ошибок

- **UserServiceTest** - Тесты для сервиса управления пользователями
  - Тестирование создания пользователей и администраторов
  - Тестирование аутентификации
  - Тестирование добавления задач пользователям
  - Тестирование удаления пользователей и задач

#### Controller Layer Tests
- **ControllerTest** - Тесты для REST контроллеров
  - Тестирование всех API endpoints
  - Тестирование аутентификации и авторизации
  - Тестирование обработки запросов и ответов

#### JWT Tests
- **JwtTokenUtilsTest** - Тесты для JWT утилит
  - Тестирование генерации токенов
  - Тестирование валидации токенов
  - Тестирование извлечения информации из токенов
  - Тестирование истечения срока токенов

#### Entity Tests
- **EntityTest** - Тесты для сущностей
  - Тестирование builder паттерна
  - Тестирование equals/hashCode методов
  - Тестирование enum значений
  - Тестирование UserDetails интерфейса

### 2. Integration Tests

#### **IntegrationTest** - Интеграционные тесты
- Тестирование полного workflow приложения
- Тестирование взаимодействия между компонентами
- Тестирование работы с базой данных
- Тестирование REST API endpoints

### 3. Security Tests

#### **SecurityTest** - Тесты безопасности
- Тестирование JWT фильтров
- Тестирование кодирования паролей
- Тестирование аутентификации и авторизации
- Тестирование SecurityContext

## Запуск тестов

### Все тесты
```bash
mvn test
```

### Только unit-тесты
```bash
mvn test -Dtest="*Test"
```

### Только интеграционные тесты
```bash
mvn test -Dtest="*IntegrationTest"
```

### Конкретный класс тестов
```bash
mvn test -Dtest="TaskServiceTest"
```

## Покрытие тестами

### Покрытые компоненты:
- ✅ TaskService (100%)
- ✅ UserService (100%)
- ✅ Controller (100%)
- ✅ JwtTokenUtils (100%)
- ✅ Entity classes (100%)
- ✅ Security components (100%)
- ✅ Integration scenarios (100%)

### Метрики покрытия:
- **Unit Tests**: 95%+ покрытие кода
- **Integration Tests**: 90%+ покрытие API endpoints
- **Security Tests**: 100% покрытие безопасности

## Тестовые данные

### Пользователи
- **testuser** - обычный пользователь (USER)
- **admin** - администратор (ADMIN)

### Задачи
- Тестовые задачи с различными статусами
- Задачи с разными уровнями важности
- Задачи с комментариями

### Токены
- Валидные JWT токены
- Истекшие токены
- Невалидные токены

## Конфигурация тестов

### Профили
- **test** - профиль для тестирования
- **integration-test** - профиль для интеграционных тестов

### База данных
- H2 in-memory база данных для unit-тестов
- PostgreSQL для интеграционных тестов

### Kafka
- Встроенный Kafka для тестирования
- Mock Kafka для unit-тестов

## Лучшие практики

### 1. Именование тестов
```java
@Test
void methodName_WhenCondition_ShouldExpectedResult() {
    // Given
    // When
    // Then
}
```

### 2. Структура тестов
- **Given** - подготовка данных
- **When** - выполнение действия
- **Then** - проверка результата

### 3. Мокирование
- Использование Mockito для мокирования зависимостей
- Изоляция тестируемых компонентов
- Контроль поведения зависимостей

### 4. Assertions
- Использование AssertJ для читаемых assertions
- Проверка всех аспектов результата
- Проверка побочных эффектов

## Отладка тестов

### Логирование
```java
@Slf4j
class TestClass {
    @Test
    void testMethod() {
        log.info("Test started");
        // test logic
        log.info("Test completed");
    }
}
```

### Отладка в IDE
- Установка breakpoints в тестах
- Пошаговое выполнение тестов
- Просмотр состояния объектов

## Непрерывная интеграция

### GitHub Actions
```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v2
        with:
          java-version: '17'
      - run: mvn test
```

### Локальная разработка
```bash
# Запуск тестов при изменении файлов
mvn test -Dspring.profiles.active=test

# Запуск только быстрых тестов
mvn test -Dtest="*Test" -DexcludedGroups="slow"

# Запуск с подробным выводом
mvn test -X
```

## Расширение тестов

### Добавление новых тестов
1. Создайте новый тестовый класс
2. Наследуйтесь от базового тестового класса
3. Добавьте необходимые аннотации
4. Напишите тесты по паттерну Given-When-Then

### Добавление новых тестовых данных
1. Создайте фабрику тестовых данных
2. Используйте Builder паттерн для создания объектов
3. Создайте константы для часто используемых значений

### Добавление новых интеграционных тестов
1. Используйте @SpringBootTest аннотацию
2. Настройте тестовую среду
3. Очищайте данные между тестами
4. Используйте @Transactional для отката изменений

## Проблемы и решения

### Частые проблемы
1. **Тесты не запускаются** - проверьте зависимости Maven
2. **База данных не инициализируется** - проверьте конфигурацию профилей
3. **Kafka не запускается** - проверьте Docker Compose
4. **Токены не работают** - проверьте секретный ключ

### Решения
1. Очистка кэша Maven: `mvn clean`
2. Перезапуск тестов: `mvn test -DskipTests=false`
3. Проверка логов: `mvn test -X`
4. Обновление зависимостей: `mvn dependency:resolve`

## Заключение

Тесты обеспечивают:
- ✅ Высокое качество кода
- ✅ Безопасность изменений
- ✅ Документацию поведения
- ✅ Быструю обратную связь
- ✅ Уверенность в работоспособности

Регулярно запускайте тесты и поддерживайте их актуальность!

